<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ms.popo</title>
    <link rel="stylesheet" href="css/all.css" />
    <link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.css" />
    <link
      rel="stylesheet"
      href="https://unpkg.com/swiper/swiper-bundle.min.css"
    />
    <link
      rel="stylesheet"
      href="https://use.fontawesome.com/releases/v5.15.2/css/all.css"
      integrity="sha384-vSIIfh2YWi9wW0r9iZe7RJPrKwp6bG+s9QZMoITbCckVJqGCCRhc+ccxNcdpHuYu"
      crossorigin="anonymous"
    />
    <script src="js/jquery-3.5.1.min.js"></script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css"
      integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.2/font/bootstrap-icons.css"
    />
    <style>
      .btn-circle {
        width: 26px;
        height: 25px;
        padding: 3.5px 0px;
        border-radius: 15px;
        text-align: center;
        font-size: 12px;
        line-height: 1.42857;
      }
    </style>
  </head>

  <body>
    <div class="wrap">
      <header class="header">
        <div class="phone">
          <h1><a href="#">Ms.popo</a></h1>
          <div class="smun">
            <a href="#"><img src="img/menu.png" alt="menu" /></a>
          </div>
        </div>
        <ul class="menu">
          <li><a href="index.html">首頁</a></li>
          <li><a href="goods.html">商城</a></li>
          <li><a href="about.html">關於我們</a></li>
          <li><a href="#" id="car"></a></li>
          <li><a href="#" class="phonesize">會員中心</a></li>
        </ul>
      </header>
      <div class="phonestyle"></div>
      <!-- <div class="sign">
            <img src="img/logo.jpg" alt="">
            <div class="username">
                <i class="fas fa-user"></i>
                <input type="text" name="" id="" placeholder="輸入帳號">
            </div>
            <div class="password">
                <i class="fas fa-lock"></i>
                <input type="password" name="" id="" placeholder="輸入密碼">
            </div>
            <div class="sigm_in">
                <input type="submit" value="登入">
            </div>
        </div> -->
      <div
        id="app"
        class="container"
        style="margin-top: 150px; margin-bottom: 30px"
      >
        <!-- {{number}} -->
        <div class="row">
          <div class="col text-center">
            <!-- <h3>購物車</h3> -->
            <div id="firebaseui-auth-container" v-if="!issignedin">
              <p>
                您還沒有帳號嗎 ? 您可以點選
                <a href="register.html"> 註冊新帳號</a>
              </p>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col text-center">
            <div v-if="issignedin">
              <!-- <div class="text-center">
                            <img :src="photoURL" class="img-fluid">
                            <div id="name">{{displayname}}</div>
                            <div id="email">{{email}}</div>
                            <div id="phone">{{phone}}</div>
                        </div>
                        <p class="text-center">
                            <button v-on:click="signOut" type="button" class="btn btn-success">登出</button>
                        </p> -->
              <div class="container-fluid mt-4">
                <div class="row">
                  <div class="col-3">
                    <div class="text-center">
                      <img :src="photoURL" class="img-fluid mb-1" />
                      <div id="name" class="mb-2">{{displayname}}</div>
                      <div id="email" class="mb-2">{{email}}</div>
                      <div id="phone" class="mb-2">{{phone}}</div>
                    </div>
                    <p class="text-center">
                      <button
                        v-on:click="signOut"
                        type="button"
                        class="btn btn-success"
                      >
                        登出
                      </button>
                    </p>
                  </div>
                  <div class="col">
                    <h3 class="text-center">清單</h3>
                    <table class="table table-striped">
                      <thead>
                        <tr class="text-center">
                          <th scope="col">圖片</th>
                          <th scope="col">名稱</th>
                          <th scope="col">顏色</th>
                          <th scope="col">尺寸</th>
                          <th scope="col">數量</th>
                          <th scope="col">單價</th>
                          <th scope="col">總價</th>
                          <th colspan="2">操作</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr
                          class="text-center"
                          v-for="(alls, idx) in oppppo"
                          :key="idx"
                        >
                          <td>
                            <img :src="alls.img" alt="" style="width: 50px" />
                          </td>
                          <td>{{alls.shopname}}</td>
                          <td>{{alls.color}}</td>
                          <td>{{alls.size}}</td>
                          <td>
                            <input
                              type="number"
                              name=""
                              id=""
                              v-model:value="number"
                              style="width: 30px"
                            />
                          </td>
                          <td>{{alls.shopmoney}}</td>
                          <td>{{alls.shopmoney * number}}</td>
                          <td class="text-center">
                            <button
                              type="button"
                              class="btn btn-danger btn-sm btn-circle"
                              data-toggle="modal"
                              data-target="#deleteModal"
                            >
                              X
                            </button>
                            <div
                              class="modal fade"
                              id="deleteModal"
                              tabindex="-1"
                              role="dialog"
                            >
                              <div class="modal-dialog">
                                <div class="modal-content">
                                  <div class="modal-header">
                                    <h5 class="modal-title">
                                      刪除 {{alls.shopname}}
                                    </h5>
                                    <button
                                      type="button"
                                      class="close"
                                      data-dismiss="modal"
                                      aria-label="Close"
                                    >
                                      <span aria-hidden="true">&times;</span>
                                    </button>
                                  </div>
                                  <div class="modal-body">
                                    <p>
                                      是否真的要刪除這筆 {{alls.shopname}}
                                      商品呢?
                                    </p>
                                  </div>
                                  <div class="modal-footer">
                                    <button
                                      type="button"
                                      class="btn btn-secondary"
                                      data-dismiss="modal"
                                    >
                                      放棄
                                    </button>
                                    <button
                                      type="button"
                                      class="btn btn-primary"
                                      @click="deleteNote(idx)"
                                    >
                                      刪除
                                    </button>
                                  </div>
                                </div>
                              </div>
                            </div>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>

            <div v-else>
              <h4>您已登出...</h4>
            </div>
          </div>
        </div>
      </div>
    </div>
    <ul class="footer">
      <li class="mspopo">
        <img src="img/footlogo.jpg" alt="footlogo" />
        <p class="add">
          <img src="img/location.png" alt="location" />一中街173號 巷弄廣場
        </p>
        <p class="line"><img src="img/line.png" alt="line" />@jkh1140c</p>
        <hr />
        <span>Copyright © Ms.popo 波波妞</span>
      </li>
      <ul class="footermenu">
        <li>
          <a href="#">
            <h5>商城</h5>
          </a>
          <a href="#">新品</a>
          <a href="#">短袖</a>
          <a href="#">短褲</a>
          <a href="#">長袖</a>
          <a href="#">長褲</a>
          <a href="#">褲子</a>
          <a href="#">配件</a>
        </li>
        <li>
          <a href="#">
            <h5>關於我們</h5>
          </a>
          <a href="#">如何聯繫我們</a>
        </li>
        <li>
          <a href="#">
            <h5>購物車</h5>
          </a>
          <a href="#">查看購物車</a>
          <a href="#">清空購物車</a>
        </li>
        <li>
          <a href="#">
            <h5>會員中心</h5>
          </a>
          <a href="#">會員登入</a>
        </li>
      </ul>
    </ul>
    <script src="https://unpkg.com/swiper/swiper-bundle.js"></script>
    <script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>
    <script src="js/all.js"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"
      integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-Fy6S3B9q64WdZWQUiU+q4/2Lc9npb8tCaSX9FK7E8HnRr0Jz8D6OP9dO5Vg3Q9ct"
      crossorigin="anonymous"
    ></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.7.13/dist/vue.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://unpkg.com/vue-firestore"></script>
    <script src="https://unpkg.com/moment"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue-router/3.0.1/vue-router.js"></script>
    <script src="https://www.gstatic.com/firebasejs/ui/6.0.2/firebase-ui-auth__zh_tw.js"></script>
    <link
      type="text/css"
      rel="stylesheet"
      href="https://www.gstatic.com/firebasejs/ui/6.0.2/firebase-ui-auth.css"
    />
    <!-- <script src="https://www.gstatic.com/firebasejs/5.5.6/firebase.js"></script> -->
    <!-- Insert this script at the bottom of the HTML, but before you use any Firebase services -->
    <!-- Insert these scripts at the bottom of the HTML, but before you use any Firebase services -->

    <!-- Firebase App (the core Firebase SDK) is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/8.9.1/firebase-app.js"></script>

    <!-- If you enabled Analytics in your project, add the Firebase SDK for Analytics -->
    <script src="https://www.gstatic.com/firebasejs/8.9.1/firebase-analytics.js"></script>

    <!-- Add Firebase products that you want to use -->
    <script src="https://www.gstatic.com/firebasejs/8.9.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.9.1/firebase-database.js"></script>
    <script src="https://unpkg.com/vuefire/dist/vuefire.js"></script>
    <script>
      const firebaseConfig = {
        apiKey: "AIzaSyAkzPPgLllbxDxNlCjIy0951n0Tsx5RVoA",
        authDomain: "mspopo.firebaseapp.com",
        databaseURL: "https://mspopo-default-rtdb.firebaseio.com",
        projectId: "mspopo",
        storageBucket: "mspopo.appspot.com",
        messagingSenderId: "1049963695733",
        appId: "1:1049963695733:web:2ee74c3bf383e2205eb23c",
      };

      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);
      var db = firebase.database();
      var myName = firebase.database().ref("shopcar");

      myName.on("value", function (snapshot) {
        // console.log(snapshot.val());
        // var str = '';
        var data = snapshot.val();
        for (var item in data) {
          // console.log(item);
          // str+='<li data-key="'+ item +'">'+data[item].img+ data[item].shopMoney+data[item].shopName+'</li>';
          vm.number = data[item].numer;
        }
        // list.innerHTML = str;
        vm.oppppo = snapshot.val();
        console.log(snapshot.val());
      });

      // var op  = this.oppppo['-NJwvZVrhxBr8Gj93gmA'].img

      var ui = new firebaseui.auth.AuthUI(firebase.auth());

      var vm = new Vue({
        el: "#app",
        data: {
          issignedin: false,
          displayname: "",
          photoURL: "",
          email: "",
          phone: "",
          oppppo: "",
          number: "",
        },
        mounted() {
          ui.start("#firebaseui-auth-container", this.getUiConfig());

          firebase.auth().onAuthStateChanged((user) => {
            if (user) {
              this.issignedin = true;
              this.displayname = user.displayname;
              this.email = user.email;
              this.photoURL = user.photoURL;
              this.phone = user.phoneNumber;
            }
          });
        },
        methods: {
          signInWithGoogle() {
            const provider = new firebase.auth.GoogleAuthProvider();
            firebase
              .auth()
              .signInWithRedirect(provider)
              .then((result) => {})
              .catch((err) => console.log(err));
          },
          signOut() {
            firebase
              .auth()
              .signOut()
              .then(() => {
                this.phone = null;
                this.displayname = "";
                this.email = "";
                this.photoURL = null;
                this.issignedin = false;
              })
              .catch((err) => console.log(err));
            window.location.reload();
            // ui.start('#firebaseui-auth-container', this.getUiConfig());
          },
          getUiConfig() {
            return {
              callbacks: {
                signInSuccessWithAuthResult: function (
                  user,
                  authResult,
                  redirectUrl
                ) {
                  this.issignedin = true;
                  this.displayname = user.displayName;
                  this.phone = user.phoneNumber;
                  this.email = user.email;
                  this.photoURL = user.photoURL;

                  return false;
                },
              },
              signInFlow: "popup",
              signInOptions: [
                firebase.auth.GoogleAuthProvider.PROVIDER_ID,
                // firebase.auth.FacebookAuthProvider.PROVIDER_ID,
                // firebase.auth.TwitterAuthProvider.PROVIDER_ID,
                // firebase.auth.GithubAuthProvider.PROVIDER_ID,
                firebase.auth.EmailAuthProvider.PROVIDER_ID,
                {
                  provider: firebase.auth.PhoneAuthProvider.PROVIDER_ID,
                  recaptchaParameters: {
                    type: "image",
                    size: "invisible",
                    badge: "bottomleft",
                  },
                  defaultCountry: "TW",
                },
              ],
              tosUrl: "https://www.google.com",
              privacyPolicyUrl: "https://www.google.com",
            };
          },
          deleteNote(key) {
            myName.child(key).remove();
            localStorage.clear();
            $("#deleteModal").modal("hide");
            window.location.reload();
          },
          selectNote(note) {
            this.noteSelected.name = note.name;
            this.noteSelected.content = note.content;
          },
        },
      });
    </script>
  </body>
</html>
